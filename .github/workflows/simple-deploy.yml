name: Simple Deploy

on:
  push:
    branches: [main]
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚’è¨±å¯

jobs:
  # ç°¡å˜ãƒ†ã‚¹ãƒˆ
  test:
    runs-on: ubuntu-latest
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements-dev.txt

      - name: åŸºæœ¬ãƒ†ã‚¹ãƒˆ
        run: |
          python pre_deploy_check.py
          python -c "from main import app; print('âœ… FastAPI ã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ')"

  # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¸ãƒ§ãƒ–
  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'

      - name: æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        run: echo "ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼"
